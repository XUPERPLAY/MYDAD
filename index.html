<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>XUPER-CHANNELS v3</title>
  <style>
    :root{--accent:#007BFF;--bg:#f4f4f4;--surface:#fff;--text:#222}
    *{box-sizing:border-box;font-family:Arial,Helvetica,sans-serif}
    body{margin:0;background:var(--bg);display:flex;flex-direction:column;min-height:100vh;color:var(--text)}
    header{background:#111;color:#fff;padding:12px 20px;text-align:center}
    header h1{margin:4px 0;font-size:1.4rem}
    .logo{height:34px;vertical-align:middle;margin-right:10px}
    .wrap{display:flex;flex:1;margin:15px;gap:15px}
    .player,.sidebar{background:var(--surface);border-radius:8px;box-shadow:0 0 10px rgba(0,0,0,.1);padding:15px}
    .player{flex:2;display:flex;flex-direction:column}
    .sidebar{flex:1;display:flex;flex-direction:column;max-height:calc(100vh - 90px)}
    #videoPlayer{width:100%;border-radius:6px}
    .controls{display:flex;gap:10px;margin-top:10px}
    .controls button{flex:1;padding:8px;border:none;border-radius:4px;background:var(--accent);color:#fff;cursor:pointer;font-size:.9rem}
    .controls button:disabled{background:#aaa;cursor:not-allowed}
    .search{margin-bottom:10px}
    .search input{width:100%;padding:8px;font-size:1rem;border:1px solid #ccc;border-radius:4px}
    #channelList{overflow-y:auto;flex:1}
    .channel-btn{display:block;margin:4px 0;padding:8px 10px;background:#eee;border-radius:4px;text-decoration:none;color:#000;font-size:.9rem;cursor:pointer}
    .channel-btn.active{background:var(--accent);color:#fff}
    .footer{background:#111;color:#aaa;text-align:center;padding:8px;font-size:.7rem}
    @media(max-width:768px){.wrap{flex-direction:column}}
  </style>
</head>
<body>
  <header>
    <h1><img src="https://i.postimg.cc/0QKq131f/logo8-2-222011.png" class="logo" alt="logo"/> XUPER-CHANNELS v3</h1>
  </header>

  <div class="wrap">
    <div class="player">
      <div class="search">
        <input id="filterInput" placeholder="Buscar canal…" autocomplete="off"/>
      </div>
      <video id="videoPlayer" controls preload="auto"></video>
      <div class="controls">
        <button id="prevBtn">Anterior</button>
        <button id="nextBtn">Siguiente</button>
      </div>
    </div>

    <div class="sidebar">
      <h3>Canales</h3>
      <div id="channelList">Cargando…</div>
    </div>
  </div>

  <footer class="footer">© Xuperlist 2025</footer>

  <script>
    // 1. Servidor propio que lee la web original
    const PROXY = 'cors.php?url='; 
    const TARGET = 'https://thedaddy.top/';

    let channels = [];
    let current = 0;

    async function loadChannels() {
      try {
        // 2. Descargamos el HTML de thedaddy.top a través de nuestro proxy
        const html = await fetch(PROXY + encodeURIComponent(TARGET)).then(r => r.text());

        // 3. Parseamos los enlaces .m3u8 que estén dentro del HTML
        const parser = new DOMParser();
        const doc = parser.parseFromString(html, 'text/html');

        channels = [...doc.querySelectorAll('a[href*=".m3u8"], source[src*=".m3u8"]')]
          .map(node => ({
            name: node.textContent.trim() || node.getAttribute('title') || 'Canal',
            url: (node.href || node.src).startsWith('http') 
                 ? (node.href || node.src) 
                 : new URL(node.href || node.src, TARGET).href
          }))
          .filter(ch => ch.url);

        if (!channels.length) throw 'No se encontraron streams';
        renderList();
        playChannel(0);
      } catch (e) {
        document.getElementById('channelList').textContent = 'Error: ' + e;
      }
    }

    function renderList(filter = '') {
      const list = document.getElementById('channelList');
      list.innerHTML = '';
      channels
        .filter(ch => ch.name.toLowerCase().includes(filter.toLowerCase()))
        .forEach((ch, idx) => {
          const btn = document.createElement('a');
          btn.className = 'channel-btn';
          btn.textContent = ch.name;
          btn.onclick = () => playChannel(idx);
          btn.id = `btn-${idx}`;
          list.appendChild(btn);
        });
    }

    function playChannel(index) {
      if (index < 0 || index >= channels.length) return;
      current = index;
      const vp = document.getElementById('videoPlayer');
      vp.src = channels[index].url;
      vp.play();
      document.querySelectorAll('.channel-btn').forEach(b => b.classList.remove('active'));
      const active = document.getElementById(`btn-${index}`);
      if (active) active.classList.add('active');
    }

    function next() { playChannel(current + 1); }
    function prev() { playChannel(current - 1); }

    document.getElementById('nextBtn').addEventListener('click', next);
    document.getElementById('prevBtn').addEventListener('click', prev);
    document.getElementById('filterInput').addEventListener('input', e => renderList(e.target.value));

    loadChannels();
  </script>
</body>
</html>
